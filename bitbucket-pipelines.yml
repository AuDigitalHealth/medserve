# This is a sample build configuration for Java (Maven).
# Check our guides at https://confluence.atlassian.com/x/zd-5Mw for more examples.
# Only use spaces to indent your .yml configuration.
# -----
# You can specify a custom docker image from Docker Hub as your build environment.
image: maven:3.3.9

options:
  docker: true
  size: 2x
  
pipelines:    
  branches:
    master:
      - step:
          caches:
            - maven
            - terminology
          script:
            - mkdir -p $BITBUCKET_CLONE_DIR/terminology
            - mvn -s settings.xml -B deploy -Dsynd.cache.dir=$BITBUCKET_CLONE_DIR/terminology
            - ssh root@medserve.online 'docker-compose pull medserve proxy; docker-compose create medserve proxy;'
          services:
            - docker

definitions:
  caches:
    terminology: $BITBUCKET_CLONE_DIR/terminology